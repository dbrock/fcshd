#!/usr/bin/env ruby

begin
  require "fcshd"
rescue LoadError
  require "pathname"
  $: << File.expand_path("../../lib", Pathname.new(__FILE__).realpath)
  require "fcshd"
end

logger = FCSHD::Logger.new(STDERR)
compiler = FCSHD::Compiler.new(logger)
compiler.start! 

Thread.abort_on_exception = true

FCSHD_PORT = 34345

begin
  logger.log "Listening to port #{FCSHD_PORT}."
  FCSHD::Server.new(FCSHD_PORT, compiler, logger).run!
rescue Interrupt
  logger.log "Exiting."
end
